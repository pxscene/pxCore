#!/bin/bash
BASE_DIR=/Applications/Pxscene.app
LOG_DIR=/var/tmp/pxscene
LOG_FILE=${LOG_DIR}/installer.out
PX=`ps -Al | grep load.sh | grep -v grep`
test -d "${LOG_DIR}" || mkdir "${LOG_DIR}"
while [ -n "${PX}" ]; do
   TS=`date "+%Y-%m-%d %H:%M:%S"`
   printf "${TS} > Found: ${PX}\n"
   printf "${TS} > Update will not complete while pxscene is running...sleeping for 60.\n" >> ${LOG_FILE} 2>&1
   sleep 60
   PX=`ps -Al | grep load.sh | grep -v grep`
done
#do install
TS=`date "+%Y-%m-%d %H:%M:%S"`
printf "${TS} > Installing new version...\n" >> ${LOG_FILE} 2>&1
TS=`date "+%Y-%m-%d %H:%M:%S"`
printf "${TS} >  Copying $1/Pxscene.app to /Applications...\n" >> ${LOG_FILE} 2>&1
cp -R "$1/Pxscene.app" /Applications/ >> ${LOG_FILE} 2>&1
TS=`date "+%Y-%m-%d %H:%M:%S"`
printf "${TS} > Install complete.\n" >> ${LOG_FILE} 2>&1
